# å®Ÿè£…ã‚¬ã‚¤ãƒ‰ - Telegram ãƒ¢ãƒã‚¤ãƒ«ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…æ‰‹é †ã¨ã‚³ã‚¢æ©Ÿèƒ½ã®å®Ÿè£…ä¾‹ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ“‹ å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŸºç›¤ï¼ˆ1-2é€±é–“ï¼‰
1. âœ… Prismaã‚¹ã‚­ãƒ¼ãƒå®šç¾©
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
3. åŸºæœ¬APIæ§‹é€ ï¼ˆExpress + TypeScriptï¼‰
4. èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆJWTï¼‰
5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
6. ãƒ­ã‚®ãƒ³ã‚°

### Phase 2: ã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…ï¼ˆ2-3é€±é–“ï¼‰
1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†API
2. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†API
3. æ³¨æ–‡ç®¡ç†API
4. Socket.IOï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ï¼‰
5. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ3-4é€±é–“ï¼‰
1. é¡§å®¢å‘ã‘Telegram Mini Apps
2. ç®¡ç†ç”»é¢ï¼ˆNext.jsï¼‰
3. Telegram Bot

### Phase 4: ãƒ†ã‚¹ãƒˆï¼†æœ€é©åŒ–ï¼ˆ1-2é€±é–“ï¼‰
1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
2. çµ±åˆãƒ†ã‚¹ãƒˆ
3. E2Eãƒ†ã‚¹ãƒˆ
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
cd C:\Users\user\gh\telBotOrder
npm install

# ã‚µãƒ¼ãƒãƒ¼
cd server
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# .env.example ã‚’ã‚³ãƒ”ãƒ¼
cp .env.example .env

# å¿…è¦ãªå€¤ã‚’è¨­å®šï¼ˆç‰¹ã«é‡è¦ï¼‰
# DATABASE_URL="postgresql://user:password@localhost:5432/telbot_order"
# JWT_SECRET="your-secret-key"
# TELEGRAM_BOT_TOKEN="your-bot-token"
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd server

# Prisma Clientç”Ÿæˆ
npm run prisma:generate

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
npm run prisma:migrate

# ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
npm run prisma:seed
```

### 4. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
cd server
npm run dev
```

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ è©³ç´°

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ app.ts                   # Expressè¨­å®š
â”‚   â”œâ”€â”€ server.ts                # HTTPã‚µãƒ¼ãƒãƒ¼ï¼‹Socket.IO
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                  # ãƒ«ãƒ¼ãƒˆå®šç¾©
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”‚   â”œâ”€â”€ session.routes.ts
â”‚   â”‚   â”œâ”€â”€ menu.routes.ts
â”‚   â”‚   â”œâ”€â”€ order.routes.ts
â”‚   â”‚   â”œâ”€â”€ table.routes.ts
â”‚   â”‚   â”œâ”€â”€ staff-call.routes.ts
â”‚   â”‚   â””â”€â”€ report.routes.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/             # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ session.controller.ts
â”‚   â”‚   â”œâ”€â”€ menu.controller.ts
â”‚   â”‚   â”œâ”€â”€ order.controller.ts
â”‚   â”‚   â”œâ”€â”€ table.controller.ts
â”‚   â”‚   â”œâ”€â”€ staff-call.controller.ts
â”‚   â”‚   â””â”€â”€ report.controller.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ session.service.ts
â”‚   â”‚   â”œâ”€â”€ menu.service.ts
â”‚   â”‚   â”œâ”€â”€ order.service.ts
â”‚   â”‚   â”œâ”€â”€ table.service.ts
â”‚   â”‚   â”œâ”€â”€ staff-call.service.ts
â”‚   â”‚   â””â”€â”€ report.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ middlewares/             # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts   # JWTèªè¨¼
â”‚   â”‚   â”œâ”€â”€ error.middleware.ts  # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ validate.middleware.ts # ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼
â”‚   â”‚   â””â”€â”€ upload.middleware.ts  # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ logger.ts            # Winstonè¨­å®š
â”‚   â”‚   â”œâ”€â”€ prisma.ts            # Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ jwt.ts               # JWTç”Ÿæˆãƒ»æ¤œè¨¼
â”‚   â”‚   â”œâ”€â”€ password.ts          # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥
â”‚   â”‚   â””â”€â”€ socket.ts            # Socket.IOè¨­å®š
â”‚   â”‚
â”‚   â””â”€â”€ types/                   # å‹å®šç¾©
â”‚       â”œâ”€â”€ express.d.ts
â”‚       â””â”€â”€ api.types.ts
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma            # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”œâ”€â”€ migrations/              # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ seed.ts                  # ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
â”‚
â””â”€â”€ tests/                       # ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ e2e/
```

## ğŸ”§ ã‚³ã‚¢å®Ÿè£…ä¾‹

### 1. Expressã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŸºæœ¬æ§‹é€ 

**server/src/index.ts**
```typescript
import dotenv from 'dotenv';
dotenv.config();

import { app } from './app';
import { server } from './server';
import { logger } from './utils/logger';

const PORT = process.env.PORT || 4000;

server.listen(PORT, () => {
  logger.info(`Server running on port ${PORT}`);
  logger.info(`Environment: ${process.env.NODE_ENV}`);
});

process.on('SIGTERM', () => {
  logger.info('SIGTERM received. Shutting down gracefully...');
  server.close(() => {
    logger.info('Server closed');
    process.exit(0);
  });
});
```

**server/src/app.ts**
```typescript
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import rateLimit from 'express-rate-limit';
import routes from './routes';
import { errorMiddleware } from './middlewares/error.middleware';
import { logger } from './utils/logger';

export const app = express();

// Security middleware
app.use(helmet());
app.use(cors({
  origin: process.env.CORS_ORIGIN?.split(',') || ['http://localhost:3000'],
  credentials: true,
}));

// Rate limiting
const limiter = rateLimit({
  windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS || '900000'), // 15 minutes
  max: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS || '100'),
});
app.use('/api/', limiter);

// Body parser
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Request logging
app.use((req, res, next) => {
  logger.info(`${req.method} ${req.path}`);
  next();
});

// Routes
app.use('/api', routes);

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// Error handling
app.use(errorMiddleware);

export default app;
```

**server/src/server.ts**
```typescript
import http from 'http';
import { Server } from 'socket.io';
import { app } from './app';
import { setupSocketIO } from './utils/socket';

export const server = http.createServer(app);

export const io = new Server(server, {
  cors: {
    origin: process.env.CORS_ORIGIN?.split(',') || ['http://localhost:3000'],
    credentials: true,
  },
});

setupSocketIO(io);
```

### 2. Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

**server/src/utils/prisma.ts**
```typescript
import { PrismaClient } from '@prisma/client';
import { logger } from './logger';

const prisma = new PrismaClient({
  log: [
    { level: 'query', emit: 'event' },
    { level: 'error', emit: 'stdout' },
    { level: 'warn', emit: 'stdout' },
  ],
});

// Log queries in development
if (process.env.NODE_ENV === 'development') {
  prisma.$on('query', (e) => {
    logger.debug(`Query: ${e.query}`);
    logger.debug(`Duration: ${e.duration}ms`);
  });
}

export default prisma;
```

### 3. èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

**server/src/middlewares/auth.middleware.ts**
```typescript
import { Request, Response, NextFunction } from 'express';
import { verifyToken } from '../utils/jwt';
import prisma from '../utils/prisma';

export interface AuthRequest extends Request {
  user?: {
    id: string;
    username: string;
    role: string;
  };
}

export const authenticate = async (
  req: AuthRequest,
  res: Response,
  next: NextFunction
) => {
  try {
    const token = req.headers.authorization?.replace('Bearer ', '');

    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }

    const decoded = verifyToken(token);
    const user = await prisma.user.findUnique({
      where: { id: decoded.userId },
      select: { id: true, username: true, role: true, isActive: true },
    });

    if (!user || !user.isActive) {
      return res.status(401).json({ error: 'Invalid token' });
    }

    req.user = user;
    next();
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
};

export const authorize = (...roles: string[]) => {
  return (req: AuthRequest, res: Response, next: NextFunction) => {
    if (!req.user) {
      return res.status(401).json({ error: 'Unauthorized' });
    }

    if (!roles.includes(req.user.role)) {
      return res.status(403).json({ error: 'Forbidden' });
    }

    next();
  };
};
```

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**server/src/middlewares/error.middleware.ts**
```typescript
import { Request, Response, NextFunction } from 'express';
import { ZodError } from 'zod';
import { Prisma } from '@prisma/client';
import { logger } from '../utils/logger';

export class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    Object.setPrototypeOf(this, AppError.prototype);
  }
}

export const errorMiddleware = (
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  logger.error(err);

  // Zod Validation Error
  if (err instanceof ZodError) {
    return res.status(400).json({
      error: 'Validation error',
      details: err.errors,
    });
  }

  // Prisma Errors
  if (err instanceof Prisma.PrismaClientKnownRequestError) {
    if (err.code === 'P2002') {
      return res.status(409).json({
        error: 'Unique constraint violation',
        field: err.meta?.target,
      });
    }
    if (err.code === 'P2025') {
      return res.status(404).json({ error: 'Record not found' });
    }
  }

  // App Error
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({ error: err.message });
  }

  // Default Error
  res.status(500).json({
    error: process.env.NODE_ENV === 'production'
      ? 'Internal server error'
      : err.message,
  });
};
```

## ğŸ“ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ä½œæˆ
- [ ] ExpressåŸºæœ¬è¨­å®š
- [ ] èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆJWTï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒ­ã‚®ãƒ³ã‚°ï¼ˆWinstonï¼‰
- [ ] Socket.IOè¨­å®š
- [ ] API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
  - [ ] èªè¨¼API
  - [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†API
  - [ ] ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†API
  - [ ] æ³¨æ–‡ç®¡ç†API
  - [ ] ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†API
  - [ ] åº—å“¡å‘¼ã³å‡ºã—API
  - [ ] ãƒ¬ãƒãƒ¼ãƒˆAPI
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆé¡§å®¢å‘ã‘ï¼‰
- [ ] Vite + React + TypeScript ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] Telegram Mini Apps SDKçµ±åˆ
- [ ] Tailwind CSSè¨­å®š
- [ ] ZustandçŠ¶æ…‹ç®¡ç†
- [ ] React Queryè¨­å®š
- [ ] ç”»é¢å®Ÿè£…ï¼ˆ9ç”»é¢ï¼‰
- [ ] APIé€£æº
- [ ] Socket.IOé€£æº

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆç®¡ç†ç”»é¢ï¼‰
- [ ] Next.js 14 ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] NextAuth.jsè¨­å®š
- [ ] shadcn/uiå°å…¥
- [ ] ç”»é¢å®Ÿè£…ï¼ˆ13ç”»é¢ï¼‰
- [ ] Chart.jsçµ±åˆ
- [ ] APIé€£æº
- [ ] Socket.IOé€£æº

### Telegram Bot
- [ ] Grammy.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
- [ ] é€šçŸ¥æ©Ÿèƒ½

### ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆ

### ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] Dockerè¨­å®š
- [ ] CI/CDè¨­å®š
- [ ] ç’°å¢ƒå¤‰æ•°ç®¡ç†
- [ ] æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

## ğŸ’¡ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   ```bash
   cd server
   npm run prisma:generate
   npm run prisma:migrate
   npm run prisma:seed
   ```

2. **ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª**
   ```bash
   npm run dev
   # http://localhost:4000/health ã§ç¢ºèª
   ```

3. **APIå®Ÿè£…é–‹å§‹**
   - èªè¨¼APIã‹ã‚‰å®Ÿè£…
   - Postmanã§ãƒ†ã‚¹ãƒˆ
   - é †æ¬¡æ©Ÿèƒ½è¿½åŠ 

4. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…**
   - ãƒ¢ãƒƒã‚¯ã‚’å‚è€ƒã«å®Ÿè£…
   - APIé€£æº
   - ãƒ†ã‚¹ãƒˆ

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦å®Ÿè£…ã‚’é€²ã‚ã‚‹ã“ã¨ã§ã€æ®µéšçš„ã«ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Œæˆã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
