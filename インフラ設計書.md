# インフラ設計書

## 1. 概要

### 1.1 システム概要
本システムは、Telegram Mini Appsを活用したモバイルオーダーシステムです。顧客はTelegramアプリ経由で注文を行い、店舗スタッフはブラウザベースの管理画面で注文管理・メニュー管理・売上管理を行います。

### 1.2 設計方針
- **スケーラビリティ**: 水平スケーリング可能なアーキテクチャ
- **可用性**: 99.9%以上の稼働率を目標
- **セキュリティ**: HTTPS必須、認証・認可の徹底
- **コスト最適化**: 開発環境は最小コスト、本番環境は段階的スケーリング
- **保守性**: コンテナ化による環境の統一、IaC（Infrastructure as Code）の採用

---

## 2. システムアーキテクチャ

### 2.1 全体構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                         顧客（Telegram）                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │ Telegram App │  │ Telegram App │  │ Telegram App │  ...    │
│  │ (Mini Apps)  │  │ (Mini Apps)  │  │ (Mini Apps)  │         │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘         │
└─────────┼──────────────────┼──────────────────┼────────────────┘
          │ HTTPS            │ HTTPS            │ HTTPS
          └──────────────────┴──────────────────┘
                              │
          ┌───────────────────▼───────────────────┐
          │      CDN / Static Asset Delivery      │
          │        (Cloudflare / Vercel)          │
          └───────────────────┬───────────────────┘
                              │
          ┌───────────────────▼───────────────────┐
          │      Load Balancer / Reverse Proxy    │
          │              (Nginx / ALB)             │
          └───────────────────┬───────────────────┘
                              │
          ┌───────────────────┴───────────────────┐
          │                                       │
┌─────────▼─────────┐              ┌─────────────▼──────────┐
│  Customer App     │              │   Admin Web            │
│  (Vite + React)   │              │   (Next.js)            │
│  Telegram Mini    │              │   店舗管理画面          │
│  Apps Frontend    │              │                        │
└─────────┬─────────┘              └─────────┬──────────────┘
          │                                  │
          │ REST API / WebSocket             │ REST API / WebSocket
          │ HTTPS                            │ HTTPS
          └──────────────┬───────────────────┘
                         │
          ┌──────────────▼──────────────┐
          │   Application Servers       │
          │   (Express + TypeScript)    │
          │   + Socket.IO               │
          │   (Auto Scaling Group)      │
          └──────────────┬──────────────┘
                         │
          ┌──────────────┴──────────────┐
          │                             │
┌─────────▼─────────┐      ┌───────────▼──────────┐
│  Telegram Bot     │      │  Database Cluster    │
│  (Grammy.js)      │      │  (PostgreSQL)        │
│  Webhook          │      │  Primary + Replica   │
└─────────┬─────────┘      └───────────┬──────────┘
          │                            │
          │                            │ Backup
          │                 ┌──────────▼──────────┐
          │                 │  Object Storage     │
          │                 │  (S3 / MinIO)       │
          │                 │  - 商品画像         │
          │                 │  - DBバックアップ   │
          │                 └─────────────────────┘
          │
┌─────────▼─────────┐
│  Session Store    │
│  (Redis Cluster)  │
└───────────────────┘

┌────────────────────────────────────────────────────────────┐
│                      監視・ログ                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐               │
│  │ Monitoring│  │  Logging │  │  Alerts  │               │
│  │ (Grafana) │  │ (Winston)│  │ (Sentry) │               │
│  └──────────┘  └──────────┘  └──────────┘               │
└────────────────────────────────────────────────────────────┘
```

### 2.2 コンポーネント構成

#### フロントエンド層
1. **顧客向けアプリ (Customer App)**
   - フレームワーク: Vite + React + TypeScript
   - Telegram Mini Apps SDK統合
   - ホスティング: Cloudflare Pages / Vercel

2. **管理画面 (Admin Web)**
   - フレームワーク: Next.js 14+ (App Router)
   - SSR/SSG対応
   - ホスティング: Vercel / Cloudflare Pages

#### アプリケーション層
1. **APIサーバー**
   - ランタイム: Node.js 20 LTS
   - フレームワーク: Express.js + TypeScript
   - リアルタイム通信: Socket.IO
   - デプロイ: Docker Container (Auto Scaling)

2. **Telegram Bot**
   - フレームワーク: Grammy.js
   - Webhook方式（Polling方式は使用しない）
   - デプロイ: APIサーバーと同一コンテナ

#### データ層
1. **データベース**
   - RDBMS: PostgreSQL 16
   - ORM: Prisma 5.x
   - 構成: Primary-Replica (読み取り分散)

2. **セッションストア**
   - Redis 7 (Cluster Mode)
   - 用途: セッション管理、リアルタイム通知キュー

3. **オブジェクトストレージ**
   - 開発: MinIO
   - 本番: AWS S3 / Cloudflare R2
   - 用途: 商品画像、DBバックアップ

---

## 3. 開発環境

### 3.1 開発環境構成

#### Docker Compose構成
```yaml
version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:16-alpine
    container_name: telbot-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: telbot_user
      POSTGRES_PASSWORD: telbot_password
      POSTGRES_DB: telbot_order
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - telbot-network

  # MinIO (S3-compatible storage)
  minio:
    image: minio/minio:latest
    container_name: telbot-minio
    restart: unless-stopped
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data
    networks:
      - telbot-network

  # Redis (Session management)
  redis:
    image: redis:7-alpine
    container_name: telbot-redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - telbot-network

  # Adminer (Database UI)
  adminer:
    image: adminer:latest
    container_name: telbot-adminer
    restart: unless-stopped
    ports:
      - "8080:8080"
    networks:
      - telbot-network

volumes:
  postgres_data:
  minio_data:
  redis_data:

networks:
  telbot-network:
    driver: bridge
```

#### ローカル開発サーバー
- 顧客アプリ: `http://localhost:5173` (Vite Dev Server)
- 管理画面: `http://localhost:3000` (Next.js Dev Server)
- APIサーバー: `http://localhost:4000` (Express)
- Telegram Bot Webhook: `https://<ngrok-url>/api/telegram/webhook`

#### 開発ツール
- **ngrok**: Telegram Webhook用の一時的なHTTPSエンドポイント
- **Adminer**: データベース管理UI (`http://localhost:8080`)
- **MinIO Console**: オブジェクトストレージUI (`http://localhost:9001`)

### 3.2 環境変数管理

#### .env.example
```bash
# Database
DATABASE_URL="postgresql://telbot_user:telbot_password@localhost:5432/telbot_order"

# Redis
REDIS_URL="redis://localhost:6379"

# MinIO / S3
S3_ENDPOINT="http://localhost:9000"
S3_ACCESS_KEY="minioadmin"
S3_SECRET_KEY="minioadmin"
S3_BUCKET_NAME="telbot-images"
S3_REGION="us-east-1"

# Telegram Bot
TELEGRAM_BOT_TOKEN="8267396699:AAEPqp5XQnf4xcHKlycTiNXEnajhzJBODmc"
TELEGRAM_BOT_USERNAME="mobail_order_bot"
TELEGRAM_WEBHOOK_URL="https://<your-domain>/api/telegram/webhook"

# JWT
JWT_SECRET="your-secret-key-change-in-production"
JWT_EXPIRES_IN="7d"

# Session
SESSION_SECRET="your-session-secret-change-in-production"

# CORS
ALLOWED_ORIGINS="http://localhost:5173,http://localhost:3000"

# Node Environment
NODE_ENV="development"
PORT=4000
```

---

## 4. 本番環境

### 4.1 本番環境アーキテクチャ

#### インフラプロバイダー
| コンポーネント | プロバイダー候補 | 選定理由 |
|--------------|----------------|---------|
| フロントエンド (顧客) | Cloudflare Pages | 高速CDN、無料枠、自動デプロイ |
| フロントエンド (管理) | Vercel | Next.js最適化、プレビュー環境 |
| バックエンド | Railway / Render | Docker対応、自動スケーリング |
| データベース | Supabase / Neon | マネージドPostgreSQL、バックアップ自動化 |
| Redis | Upstash | サーバーレスRedis、従量課金 |
| オブジェクトストレージ | Cloudflare R2 | S3互換、低コスト、CDN統合 |
| 監視 | Sentry / Grafana Cloud | エラートラッキング、メトリクス |

#### ホスティング構成（Phase 1: MVP）
```
Cloudflare Pages (顧客アプリ)
    ↓ HTTPS
Railway (APIサーバー + Bot)
    ↓ TCP
Supabase (PostgreSQL)
Upstash (Redis)
Cloudflare R2 (画像ストレージ)
```

#### ホスティング構成（Phase 2: スケーリング）
```
Cloudflare Pages + CDN (顧客アプリ)
    ↓ HTTPS
AWS ALB / Nginx (Load Balancer)
    ↓
AWS ECS / Kubernetes (APIサーバー Auto Scaling)
    ↓
AWS RDS PostgreSQL (Multi-AZ)
AWS ElastiCache Redis (Cluster Mode)
AWS S3 + CloudFront (画像配信)
```

### 4.2 スケーリング戦略

#### 水平スケーリング
1. **APIサーバー**
   - Auto Scaling Group (CPU使用率 70%でスケールアウト)
   - 最小インスタンス: 2台
   - 最大インスタンス: 10台

2. **データベース**
   - Read Replica (読み取り負荷分散)
   - Connection Pooling (Prisma + PgBouncer)

3. **Redis**
   - Cluster Mode (Sharding)
   - Read Replica (読み取り専用)

#### 垂直スケーリング
- データベース: メモリ増強 (4GB → 8GB → 16GB)
- APIサーバー: CPU/メモリ増強 (2vCPU/4GB → 4vCPU/8GB)

### 4.3 可用性設計

#### 冗長化
- **データベース**: Multi-AZ構成、自動フェイルオーバー
- **APIサーバー**: 複数AZ配置、ヘルスチェック
- **Redis**: レプリケーション、Sentinelによる自動フェイルオーバー

#### バックアップ
- **データベース**: 毎日自動バックアップ、7日間保持
- **オブジェクトストレージ**: バージョニング有効化
- **設定ファイル**: Git管理、タグ付け

#### 災害復旧（DR）
- **RTO (Recovery Time Objective)**: 1時間以内
- **RPO (Recovery Point Objective)**: 1時間以内
- **復旧手順書**: ドキュメント化、定期的な復旧訓練

### 4.4 セキュリティ設計

#### ネットワークセキュリティ
- **HTTPS**: Let's Encrypt / Cloudflare SSL (TLS 1.2以上)
- **CORS**: ホワイトリスト方式（許可されたオリジンのみ）
- **Firewall**: セキュリティグループ / WAF
- **DDoS対策**: Cloudflare DDoS Protection

#### アプリケーションセキュリティ
- **認証**: JWT (HS256)、有効期限7日
- **認可**: ロールベースアクセス制御（RBAC）
- **入力検証**: Zodによるスキーマバリデーション
- **SQLインジェクション対策**: Prisma（パラメータ化クエリ）
- **XSS対策**: DOMPurify、Content Security Policy (CSP)
- **CSRF対策**: SameSite Cookie、CSRFトークン
- **レート制限**: express-rate-limit (API: 100req/min/IP)

#### データセキュリティ
- **暗号化（保存時）**: データベース暗号化（AES-256）
- **暗号化（通信時）**: TLS 1.2以上
- **秘密情報管理**: 環境変数、AWS Secrets Manager / Doppler
- **パスワード**: bcrypt (ソルト10ラウンド)

#### 監査・コンプライアンス
- **アクセスログ**: すべてのAPI呼び出しをログ記録
- **認証ログ**: ログイン成功/失敗、IPアドレス記録
- **データ保持**: GDPR対応、個人データの削除要求対応

---

## 5. CI/CD

### 5.1 CI/CDパイプライン

#### GitHub Actions Workflow

```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run lint
      - run: npm run test
      - run: npm run build

  deploy-frontend:
    needs: lint-and-test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      # Cloudflare Pages / Vercel自動デプロイ
      - name: Deploy Customer App
        run: npx wrangler pages deploy apps/customer-app/dist
      - name: Deploy Admin Web
        run: npx vercel deploy --prod

  deploy-backend:
    needs: lint-and-test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      # Railway / Renderへの自動デプロイ
      - name: Deploy to Railway
        run: railway up
```

#### デプロイフロー
1. **開発環境** (develop branch)
   - プルリクエスト → 自動テスト → プレビュー環境デプロイ
2. **ステージング環境** (main branch)
   - マージ → 自動テスト → ステージング環境デプロイ
3. **本番環境** (main branch + タグ)
   - タグ作成 (`v1.0.0`) → 自動テスト → 本番環境デプロイ

### 5.2 デプロイ戦略

#### ブルー/グリーンデプロイ
- 旧バージョン（ブルー）と新バージョン（グリーン）を並行稼働
- ヘルスチェック成功後にトラフィック切り替え
- 問題発生時は即座にロールバック

#### カナリアデプロイ（将来的に）
- 新バージョンへのトラフィックを段階的に増加（5% → 50% → 100%）
- エラーレート監視、閾値超過でロールバック

---

## 6. 監視・ログ

### 6.1 監視項目

#### インフラメトリクス
- **CPU使用率**: 閾値 70%
- **メモリ使用率**: 閾値 80%
- **ディスク使用率**: 閾値 85%
- **ネットワーク I/O**: 帯域幅監視

#### アプリケーションメトリクス
- **APIレスポンスタイム**: p50, p95, p99
- **エラーレート**: 5分間隔、閾値 1%
- **リクエスト数**: QPS (Queries Per Second)
- **同時接続数**: Socket.IO接続数

#### ビジネスメトリクス
- **注文数**: 時間帯別、日別
- **セッション数**: アクティブセッション数
- **ユーザー数**: DAU (Daily Active Users)

### 6.2 ログ管理

#### ログレベル
- **ERROR**: エラー、例外
- **WARN**: 警告、リトライ
- **INFO**: 重要なビジネスイベント（注文作成、会計完了）
- **DEBUG**: デバッグ情報（開発環境のみ）

#### ログ出力形式（構造化ログ）
```json
{
  "timestamp": "2025-11-21T22:00:00.000Z",
  "level": "INFO",
  "service": "api-server",
  "traceId": "abc123",
  "userId": "user_456",
  "message": "Order created",
  "metadata": {
    "orderId": "order_789",
    "sessionId": "session_012",
    "amount": 2500
  }
}
```

#### ログ保存先
- **開発環境**: ローカルファイル + コンソール出力
- **本番環境**: Cloudwatch Logs / Grafana Loki

#### ログ保持期間
- **ERROR**: 90日
- **WARN/INFO**: 30日
- **DEBUG**: 7日

### 6.3 アラート設定

#### クリティカルアラート（即座に対応）
- APIサーバーダウン
- データベース接続エラー
- エラーレート > 5%
- レスポンスタイム p95 > 3秒

#### 警告アラート（営業時間内に対応）
- CPU使用率 > 70%
- ディスク使用率 > 85%
- エラーレート > 1%

#### アラート通知先
- **Slack**: #alerts-critical, #alerts-warning
- **メール**: devops@example.com
- **PagerDuty**: 営業時間外のクリティカルアラート

---

## 7. パフォーマンス最適化

### 7.1 フロントエンド最適化

#### バンドルサイズ削減
- Tree Shaking（未使用コードの削除）
- Code Splitting（ルート単位での分割）
- Dynamic Import（遅延読み込み）
- 画像最適化（WebP、Lazy Loading）

#### キャッシング戦略
- **静的アセット**: Cache-Control: max-age=31536000（1年）
- **API レスポンス**: React Queryのキャッシング（5分）
- **Service Worker**: オフライン対応（将来的に）

### 7.2 バックエンド最適化

#### データベースクエリ最適化
- **インデックス作成**: 頻繁に検索されるカラム
- **N+1問題対策**: Prismaの`include`による効率的なクエリ
- **Connection Pooling**: 接続再利用、最大接続数100

#### キャッシング戦略
- **Redisキャッシュ**: メニューデータ（TTL: 5分）
- **Application Cache**: インメモリキャッシング
- **CDN Cache**: 静的ファイル、画像

### 7.3 画像最適化

#### 画像配信戦略
- **フォーマット**: WebP優先、フォールバックJPEG
- **サイズ**: サムネイル（400x300）、詳細（800x600）
- **CDN**: Cloudflare / CloudFront
- **遅延読み込み**: Intersection Observer API

#### 画像圧縮
- **品質**: JPEG 85%、WebP 80%
- **メタデータ削除**: EXIF情報削除

---

## 8. コスト見積もり

### 8.1 開発環境コスト

| リソース | 料金 |
|---------|------|
| ローカル開発 | 無料 |
| Docker Desktop | 無料 |
| ngrok (Free Tier) | 無料 |
| GitHub (Free Tier) | 無料 |
| **合計** | **無料** |

### 8.2 本番環境コスト（MVP: 月間1000注文想定）

| サービス | プラン | 月額費用 |
|---------|-------|---------|
| Cloudflare Pages | Free | $0 |
| Vercel | Hobby | $0 |
| Railway | Developer ($5/月 + 使用量) | $10 |
| Supabase | Free (500MB) | $0 |
| Upstash Redis | Free (10K commands/day) | $0 |
| Cloudflare R2 | Free (10GB) | $0 |
| Sentry | Free (5K events/month) | $0 |
| **合計** | | **$10/月** |

### 8.3 本番環境コスト（スケール: 月間10万注文想定）

| サービス | プラン | 月額費用 |
|---------|-------|---------|
| Cloudflare Pages + CDN | Pro | $20 |
| Vercel | Pro | $20 |
| Railway | Team ($20/月 + 使用量) | $100 |
| Supabase | Pro (8GB) | $25 |
| Upstash Redis | Pay as you go | $50 |
| Cloudflare R2 | Pay as you go (100GB) | $15 |
| Sentry | Team | $26 |
| **合計** | | **$256/月** |

### 8.4 AWS構成の場合（スケール: 月間10万注文想定）

| サービス | 構成 | 月額費用 |
|---------|------|---------|
| EC2 (APIサーバー) | t3.medium x2 (Auto Scaling) | $60 |
| RDS PostgreSQL | db.t4g.medium (Multi-AZ) | $100 |
| ElastiCache Redis | cache.t4g.micro | $20 |
| S3 + CloudFront | 100GB + 転送量 | $30 |
| ALB | 1台 | $20 |
| Route 53 | Hosted Zone | $1 |
| CloudWatch | ログ + メトリクス | $10 |
| **合計** | | **$241/月** |

---

## 9. 運用手順

### 9.1 デプロイ手順

#### 通常デプロイ
1. feature branchで開発
2. Pull Request作成
3. 自動テスト実行
4. コードレビュー承認
5. main branchへマージ
6. 自動デプロイ実行
7. デプロイ完了通知（Slack）

#### 緊急デプロイ（ホットフィックス）
1. main branchから hotfix/xxx ブランチ作成
2. 修正コミット
3. Pull Request作成（レビュー簡略化）
4. マージ後、即座にデプロイ
5. 事後報告（インシデントレポート作成）

### 9.2 バックアップ・リストア手順

#### データベースバックアップ
```bash
# バックアップ（毎日0:00 UTC）
pg_dump -h <host> -U <user> -d telbot_order > backup_$(date +%Y%m%d).sql

# S3にアップロード
aws s3 cp backup_$(date +%Y%m%d).sql s3://telbot-backups/db/
```

#### データベースリストア
```bash
# S3からダウンロード
aws s3 cp s3://telbot-backups/db/backup_20251121.sql .

# リストア
psql -h <host> -U <user> -d telbot_order < backup_20251121.sql
```

### 9.3 障害対応手順

#### レベル1（サービス停止）
1. アラート受信
2. 原因特定（ログ、メトリクス確認）
3. ロールバック実行
4. サービス復旧確認
5. インシデントレポート作成

#### レベル2（性能劣化）
1. アラート受信
2. メトリクス分析
3. スケールアウト実行
4. パフォーマンス改善（必要に応じて）

### 9.4 メンテナンス

#### 定期メンテナンス
- **依存パッケージ更新**: 月1回（セキュリティパッチは即座に適用）
- **データベース最適化**: 月1回（VACUUM、ANALYZE）
- **ログローテーション**: 自動（30日経過で削除）
- **SSL証明書更新**: 自動（Let's Encrypt）

#### 計画メンテナンス
- **事前通知**: 7日前に顧客へ通知
- **実施時間**: 深夜2:00-4:00 UTC（利用が少ない時間帯）
- **ロールバックプラン**: 事前に準備

---

## 10. 移行計画

### 10.1 開発環境 → 本番環境移行

#### Phase 1: MVP環境構築（Week 1-2）
1. Cloudflare Pagesアカウント作成
2. Vercelアカウント作成
3. Railwayプロジェクト作成
4. Supabase PostgreSQLセットアップ
5. Upstash Redisセットアップ
6. Cloudflare R2バケット作成
7. 環境変数設定
8. 初回デプロイ

#### Phase 2: テスト運用（Week 3-4）
1. 社内テスト（管理画面、注文フロー）
2. 負荷テスト（Apache JMeter）
3. セキュリティテスト（OWASP ZAP）
4. バックアップ・リストアテスト
5. 障害復旧テスト

#### Phase 3: 本番リリース（Week 5）
1. データ移行（マスターデータ投入）
2. Telegram Bot Webhook設定
3. DNS設定
4. SSL証明書設定
5. 監視・アラート設定
6. ソフトローンチ（限定的な顧客）

#### Phase 4: フルリリース（Week 6-）
1. 全店舗展開
2. 運用監視
3. フィードバック収集
4. 機能改善

### 10.2 スケーリング移行（将来的に）

#### 移行タイミング
- 月間注文数 > 5万件
- 同時接続数 > 500
- レスポンスタイム p95 > 2秒

#### 移行先
- Railway → AWS ECS / Kubernetes
- Supabase → AWS RDS (Multi-AZ)
- Upstash → AWS ElastiCache (Cluster Mode)

---

## 11. セキュリティ運用

### 11.1 脆弱性管理

#### 定期スキャン
- **依存パッケージ**: `npm audit` (週1回)
- **コンテナイメージ**: Trivy (ビルド時)
- **Webアプリケーション**: OWASP ZAP (月1回)

#### 脆弱性対応フロー
1. 脆弱性検出
2. 影響範囲調査
3. パッチ適用 or 回避策実施
4. 再スキャンで確認
5. 対応完了報告

### 11.2 アクセス管理

#### 権限管理
- **管理画面**: ロール別アクセス制御（admin, chef, supervisor, staff）
- **データベース**: 最小権限の原則（読み取り専用、書き込み制限）
- **本番環境**: MFA必須、IP制限

#### 監査ログ
- ログイン履歴
- データ変更履歴（Who, What, When）
- API呼び出しログ

---

## 12. ドキュメント管理

### 12.1 ドキュメント一覧

| ドキュメント名 | 目的 | 更新頻度 |
|--------------|------|---------|
| システム構成図 | 全体アーキテクチャ | 機能追加時 |
| API仕様書 | API定義（OpenAPI） | API変更時 |
| データモデル設計書 | テーブル定義 | スキーマ変更時 |
| 運用手順書 | デプロイ、障害対応 | 四半期ごと |
| セキュリティガイドライン | セキュリティ基準 | 年1回 |
| インシデントレポート | 障害記録 | 発生時 |

### 12.2 ドキュメント保存先

- **設計ドキュメント**: GitHub Repository (`/docs`)
- **運用手順書**: Notion / Confluence
- **API仕様書**: Swagger UI (自動生成)
- **インシデントレポート**: GitHub Issues

---

## 13. 今後の拡張性

### 13.1 機能拡張

#### Phase 2機能（3-6ヶ月後）
- 店員呼び出し機能強化
- 売上レポート機能（グラフ、CSV出力）
- 複数店舗管理（マルチテナント）
- POSレジ連携API

#### Phase 3機能（6-12ヶ月後）
- 顧客ロイヤルティプログラム
- クーポン・割引機能
- 予約機能
- モバイルアプリ（ネイティブ）

### 13.2 技術的拡張

#### マイクロサービス化（将来的に）
- 注文サービス
- メニュー管理サービス
- 会計サービス
- 通知サービス

#### リアルタイム機能強化
- WebRTC（ビデオ通話）
- AR（拡張現実）メニュー表示
- プッシュ通知（Web Push API）

---

## 14. 参考資料

### 14.1 技術スタック公式ドキュメント

- **React**: https://react.dev/
- **Next.js**: https://nextjs.org/docs
- **Express.js**: https://expressjs.com/
- **Prisma**: https://www.prisma.io/docs
- **PostgreSQL**: https://www.postgresql.org/docs/
- **Redis**: https://redis.io/docs/
- **Telegram Bot API**: https://core.telegram.org/bots/api
- **Telegram Mini Apps**: https://core.telegram.org/bots/webapps

### 14.2 インフラ・クラウドドキュメント

- **Cloudflare Pages**: https://developers.cloudflare.com/pages/
- **Vercel**: https://vercel.com/docs
- **Railway**: https://docs.railway.app/
- **Supabase**: https://supabase.com/docs
- **AWS**: https://docs.aws.amazon.com/

### 14.3 ベストプラクティス

- **The Twelve-Factor App**: https://12factor.net/
- **OWASP Top 10**: https://owasp.org/www-project-top-ten/
- **Well-Architected Framework (AWS)**: https://aws.amazon.com/architecture/well-architected/

---

## 付録A: 用語集

| 用語 | 説明 |
|-----|------|
| **CDN** | Content Delivery Network - コンテンツ配信ネットワーク |
| **CORS** | Cross-Origin Resource Sharing - オリジン間リソース共有 |
| **DR** | Disaster Recovery - 災害復旧 |
| **IaC** | Infrastructure as Code - コードによるインフラ管理 |
| **JWT** | JSON Web Token - 認証トークン |
| **ORM** | Object-Relational Mapping - オブジェクト関係マッピング |
| **QPS** | Queries Per Second - 秒間クエリ数 |
| **RBAC** | Role-Based Access Control - ロールベースアクセス制御 |
| **RPO** | Recovery Point Objective - 目標復旧時点 |
| **RTO** | Recovery Time Objective - 目標復旧時間 |
| **SSR** | Server-Side Rendering - サーバーサイドレンダリング |
| **TTL** | Time To Live - 生存時間 |
| **WAF** | Web Application Firewall - Webアプリケーションファイアウォール |

---

## 付録B: チェックリスト

### デプロイ前チェックリスト

- [ ] 環境変数がすべて設定されている
- [ ] データベースマイグレーションが完了している
- [ ] SSL証明書が有効である
- [ ] バックアップが正常に動作している
- [ ] 監視・アラートが設定されている
- [ ] ロールバックプランが準備されている
- [ ] セキュリティスキャンが完了している
- [ ] 負荷テストが完了している
- [ ] ドキュメントが更新されている

### 障害対応チェックリスト

- [ ] アラート内容を確認
- [ ] 現在の状況を記録（スクリーンショット、ログ）
- [ ] 影響範囲を特定
- [ ] ロールバック or ホットフィックス判断
- [ ] 対応実施
- [ ] サービス復旧確認
- [ ] 関係者へ報告
- [ ] インシデントレポート作成
- [ ] 再発防止策検討

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|----------|------|---------|-------|
| 1.0.0 | 2025-11-21 | 初版作成 | - |

---

**作成日**: 2025年11月21日  
**最終更新**: 2025年11月21日  
**承認者**: -  
