# 技術スタック選定

## フロントエンド（顧客向け: Telegram Mini Apps）

### フレームワーク
- **React 18.2+** with TypeScript
  - 理由：コンポーネントベース、型安全性、Telegram Mini Apps SDKとの相性

### UI/スタイリング
- **Tailwind CSS 3.x**
  - 理由：ユーティリティファースト、モックデザインとの親和性
- **Headless UI**
  - 理由：アクセシビリティ対応、カスタマイズ性

### 状態管理
- **Zustand**
  - 理由：軽量、TypeScript対応、シンプルなAPI

### データ取得
- **TanStack Query (React Query) v5**
  - 理由：キャッシング、自動リフレッシュ、楽観的更新

### Telegram連携
- **@twa-dev/sdk**
  - 理由：Telegram Mini Apps公式SDK

## フロントエンド（店舗管理画面: Web）

### フレームワーク
- **Next.js 14+ (App Router)**
  - 理由：SSR/SSG、API Routes、最新のReact機能

### UI/スタイリング
- **Tailwind CSS 3.x**
- **shadcn/ui**
  - 理由：高品質なコンポーネント、カスタマイズ性

### 状態管理
- **Zustand**

### データ取得
- **TanStack Query v5**

### 認証
- **NextAuth.js v5**
  - 理由：認証フロー、セッション管理、JWT対応

### グラフ表示
- **Chart.js 4.x** + **react-chartjs-2**
  - 理由：売上グラフ、豊富なチャートタイプ

## バックエンド

### ランタイム
- **Node.js 20 LTS**

### フレームワーク
- **Express.js 4.x**
  - 理由：シンプル、豊富なミドルウェア、実績

### 言語
- **TypeScript 5.x**
  - 理由：型安全性、保守性向上

### データベース
- **PostgreSQL 16**
  - 理由：ACID準拠、JSON対応、拡張性

### ORM
- **Prisma 5.x**
  - 理由：型安全、マイグレーション、スキーマ駆動

### リアルタイム通信
- **Socket.IO 4.x**
  - 理由：注文通知、ステータス更新、Fallback対応

### 認証
- **JWT (jsonwebtoken)**
  - 理由：ステートレス、スケーラビリティ

### バリデーション
- **Zod**
  - 理由：TypeScript連携、ランタイムバリデーション

### ファイルアップロード
- **Multer**
  - 理由：商品画像アップロード

### ファイル保存
- **AWS S3** または **MinIO**（開発用）
  - 理由：スケーラブル、CDN連携

## Telegram Bot

### フレームワーク
- **Grammy.js**
  - 理由：TypeScript対応、モダンなAPI、Telegram Bot API完全対応

## 開発ツール

### ビルドツール
- **Vite 5.x**（顧客向けフロントエンド）
- **Next.js内蔵**（管理画面）

### リンター/フォーマッター
- **ESLint 8.x**
- **Prettier 3.x**

### テスティング
- **Vitest**（ユニットテスト）
- **Playwright**（E2Eテスト）
- **Testing Library**（コンポーネントテスト）

### 型チェック
- **TypeScript Compiler**

### API ドキュメント
- **Swagger/OpenAPI 3.0**

### 環境変数管理
- **dotenv**

## インフラ（開発環境）

### コンテナ化
- **Docker + Docker Compose**
  - PostgreSQL
  - MinIO
  - Redis（セッション管理）

### リバースプロキシ
- **Nginx**（本番環境）

## インフラ（本番環境候補）

### ホスティング
- **Vercel**（管理画面フロントエンド）
- **Railway/Render**（バックエンド）
- **Cloudflare Pages**（顧客向けフロントエンド）

### データベース
- **Supabase/Neon**（PostgreSQL）

### オブジェクトストレージ
- **AWS S3/Cloudflare R2**

### リアルタイム
- **自社サーバー + Socket.IO**

## CI/CD

### CI
- **GitHub Actions**
  - リント
  - テスト
  - ビルド

### CD
- **自動デプロイ**（Vercel/Railway）

## 監視・ログ

### エラートラッキング
- **Sentry**

### ログ管理
- **Winston**（構造化ログ）

### パフォーマンス監視
- **Vercel Analytics**

## セキュリティ

### HTTPS
- **必須**（Let's Encrypt）

### CORS
- **設定済み**（オリジン制限）

### レート制限
- **express-rate-limit**

### SQL インジェクション対策
- **Prisma（パラメータ化クエリ）**

### XSS 対策
- **DOMPurify**

### CSRF 対策
- **SameSite Cookie + CSRF Token**

## プロジェクト構成

```
telBotOrder/
├── apps/
│   ├── customer-app/          # 顧客向けTelegram Mini Apps (Vite + React)
│   ├── admin-web/             # 管理画面 (Next.js)
│   └── bot/                   # Telegram Bot (Grammy.js)
├── packages/
│   ├── api-client/            # API型定義共有
│   ├── ui/                    # 共通UIコンポーネント
│   └── utils/                 # 共通ユーティリティ
├── server/                    # バックエンド (Express + Prisma)
│   ├── src/
│   │   ├── routes/
│   │   ├── controllers/
│   │   ├── services/
│   │   ├── models/
│   │   ├── middlewares/
│   │   └── utils/
│   ├── prisma/
│   │   └── schema.prisma
│   └── tests/
├── docker/                    # Docker設定
├── docs/                      # ドキュメント
└── scripts/                   # スクリプト
```

## バージョン管理

### パッケージマネージャー
- **pnpm 8.x**
  - 理由：高速、ディスク節約、モノレポ対応

### モノレポツール
- **Turborepo**
  - 理由：ビルドキャッシング、並列実行

## 理由・選定基準

### 1. 型安全性
- TypeScript全面採用
- Zod、Prismaによるランタイムバリデーション

### 2. 開発効率
- ホットリロード
- 型推論
- 自動生成（Prisma Client）

### 3. パフォーマンス
- Viteの高速ビルド
- Next.jsのSSR/SSG
- React Queryのキャッシング

### 4. 保守性
- モノレポ構成
- コードの再利用
- 統一されたツールチェーン

### 5. スケーラビリティ
- ステートレスAPI
- Socket.IOのスケールアウト対応
- PostgreSQLのレプリケーション

### 6. セキュリティ
- JWT認証
- HTTPS必須
- レート制限
- パラメータ化クエリ

### 7. コスト効率
- 無料枠活用（Vercel、Supabase）
- オープンソース優先
- オンデマンドスケーリング

### 8. 実績・コミュニティ
- 広く使われている技術
- 豊富なドキュメント
- アクティブなコミュニティ

## 開発フェーズ

### Phase 1: MVP（最小機能製品）
- 基本的な注文フロー
- 管理画面（注文・メニュー管理）
- Telegram Bot（QRコード生成）

### Phase 2: 機能拡張
- 店員呼び出し
- 会計機能
- 売上管理

### Phase 3: 最適化
- パフォーマンス改善
- UX改善
- テストカバレッジ向上

### Phase 4: 本番リリース
- セキュリティ監査
- 負荷テスト
- ドキュメント整備
