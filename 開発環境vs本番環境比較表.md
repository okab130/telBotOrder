# 開発環境 vs 本番環境 コンポーネント比較表

## 全体比較サマリー

| 環境 | 目的 | コスト | 特徴 |
|-----|------|-------|------|
| **開発環境** | ローカル開発・テスト | 無料 | Docker Compose、手動起動 |
| **本番環境（MVP）** | 小規模運用 | $10/月 | マネージドサービス、自動スケール |
| **本番環境（スケール）** | 大規模運用 | $250〜/月 | 冗長化、オートスケーリング |

---

## 詳細コンポーネント比較

### 1. フロントエンド層

| コンポーネント | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|--------------|---------|---------------|-------------------|-------------|
| **顧客アプリ** | Vite Dev Server<br>`localhost:5173` | Cloudflare Pages<br>グローバルCDN | Cloudflare Pages<br>+ CDN最適化 | **相違**: 開発はHMR、本番は静的配信<br>**理由**: 開発速度 vs 本番パフォーマンス |
| **管理画面** | Next.js Dev Server<br>`localhost:3000` | Vercel<br>自動デプロイ | Vercel<br>Edge Network | **同様**: Next.js使用<br>**相違**: 開発はSSRなし、本番はSSR |
| **ホットリロード** | ✅ あり（HMR） | ❌ なし | ❌ なし | **理由**: 開発効率向上 |
| **ビルド最適化** | ❌ なし | ✅ Tree Shaking<br>Code Splitting | ✅ 同左 + CDN | **理由**: 本番はバンドルサイズ削減 |
| **HTTPS** | ❌ HTTP | ✅ 自動SSL | ✅ 自動SSL | **理由**: 開発は不要、本番は必須 |

---

### 2. アプリケーション層

| コンポーネント | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|--------------|---------|---------------|-------------------|-------------|
| **APIサーバー** | Express (tsx watch)<br>`localhost:4000` | Railway/Render<br>Docker Container | AWS ECS / K8s<br>Auto Scaling (2〜10台) | **同様**: Express + TypeScript<br>**相違**: 起動方法、スケーリング |
| **Telegram Bot** | Grammy.js (tsx watch)<br>ローカル実行 | 同一コンテナ<br>Webhook方式 | 同一コンテナ<br>Webhook方式 | **同様**: Grammy.js使用<br>**相違**: Webhook URLが異なる |
| **リアルタイム通信** | Socket.IO<br>単一インスタンス | Socket.IO<br>Redis Adapter | Socket.IO<br>Redis Adapter + Cluster | **同様**: Socket.IO使用<br>**相違**: 本番は複数インスタンス対応 |
| **自動再起動** | tsx watch<br>(ファイル変更時) | PM2 / Docker healthcheck | Kubernetes liveness probe | **理由**: 開発は即座反映、本番は自動復旧 |
| **環境変数** | .env ファイル | 環境変数設定<br>(Railway/Render) | AWS Secrets Manager | **同様**: 環境変数使用<br>**相違**: 本番は暗号化・バージョン管理 |
| **ログ** | Console出力 | Railway Logs | CloudWatch / Grafana Loki | **理由**: 本番は集約・検索・アラート必要 |

---

### 3. データ層

#### 3.1 データベース

| 項目 | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|-----|---------|---------------|-------------------|-------------|
| **RDBMS** | PostgreSQL 16<br>Docker Container | Supabase / Neon<br>マネージド | AWS RDS PostgreSQL<br>Multi-AZ | **同様**: PostgreSQL 16使用<br>**相違**: 管理方法、冗長化 |
| **接続先** | `localhost:5432` | `xxx.supabase.co:5432` | `xxx.rds.amazonaws.com:5432` | **理由**: 環境により接続先変更 |
| **ORM** | Prisma 5.x | Prisma 5.x | Prisma 5.x | **完全同様**: 全環境で統一 |
| **バックアップ** | ❌ なし（手動） | ✅ 自動（日次） | ✅ 自動（時間ごと）<br>+ Point-in-Time Recovery | **理由**: 本番はデータ保護必須 |
| **冗長化** | ❌ 単一インスタンス | ❌ 単一インスタンス | ✅ Primary + Replica<br>Multi-AZ | **理由**: スケール時は可用性向上 |
| **Connection Pool** | 10接続 | 10接続 | 100接続<br>PgBouncer | **理由**: 負荷に応じて調整 |
| **管理UI** | Adminer<br>`localhost:8080` | Supabase Dashboard | AWS RDS Console | **相違**: UIは異なるが機能同等 |

#### 3.2 セッションストア

| 項目 | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|-----|---------|---------------|-------------------|-------------|
| **キャッシュ** | Redis 7<br>Docker Container | Upstash Redis<br>サーバーレス | AWS ElastiCache<br>Cluster Mode | **同様**: Redis 7使用<br>**相違**: 管理方法、スケール |
| **接続先** | `localhost:6379` | `xxx.upstash.io:6379` | `xxx.cache.amazonaws.com:6379` | **理由**: 環境により変更 |
| **永続化** | ✅ RDB/AOF | ✅ 自動永続化 | ✅ 自動永続化 | **同様**: データ保護 |
| **冗長化** | ❌ 単一インスタンス | ❌ 単一インスタンス | ✅ Cluster (3〜6ノード)<br>Sentinel | **理由**: スケール時は高可用性 |
| **メモリ** | 256MB | 256MB | 1GB〜 | **理由**: 負荷に応じて増強 |

#### 3.3 オブジェクトストレージ

| 項目 | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|-----|---------|---------------|-------------------|-------------|
| **ストレージ** | MinIO<br>Docker Container | Cloudflare R2<br>S3互換 | AWS S3 + CloudFront | **同様**: S3互換API<br>**相違**: 本番はCDN統合 |
| **接続先** | `localhost:9000` | `xxx.r2.cloudflarestorage.com` | `xxx.s3.amazonaws.com` | **理由**: 環境により変更 |
| **管理UI** | MinIO Console<br>`localhost:9001` | Cloudflare Dashboard | AWS S3 Console | **相違**: UIは異なるが機能同等 |
| **CDN** | ❌ なし | ✅ Cloudflare CDN | ✅ CloudFront | **理由**: 本番は画像配信高速化 |
| **バックアップ** | ❌ なし | ✅ バージョニング | ✅ バージョニング<br>+ Cross-Region Replication | **理由**: 本番はデータ保護 |
| **容量** | 無制限（ローカルディスク） | 10GB（無料枠） | 100GB〜 | **理由**: 負荷に応じて拡張 |

---

### 4. インフラ・運用ツール

| コンポーネント | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|--------------|---------|---------------|-------------------|-------------|
| **コンテナ管理** | Docker Compose | Railway/Render | AWS ECS / Kubernetes | **同様**: Docker使用<br>**相違**: オーケストレーション |
| **ロードバランサー** | ❌ なし | ❌ なし | ✅ AWS ALB / Nginx | **理由**: スケール時は負荷分散必要 |
| **リバースプロキシ** | ❌ なし | ✅ 自動設定 | ✅ Nginx / Cloudflare | **理由**: 本番はHTTPS終端・セキュリティ |
| **監視** | ❌ なし | ✅ Railway Metrics | ✅ Grafana + Prometheus | **理由**: 本番は監視必須 |
| **ログ管理** | Console出力 | Railway Logs | CloudWatch / Loki | **理由**: 本番は集約・検索 |
| **エラートラッキング** | ❌ なし | ✅ Sentry (無料枠) | ✅ Sentry (有料プラン) | **理由**: 本番はエラー通知 |
| **CI/CD** | ❌ 手動 | ✅ GitHub Actions<br>自動デプロイ | ✅ GitHub Actions<br>+ ブルー/グリーン | **理由**: 本番は自動化 |

---

### 5. セキュリティ

| 項目 | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|-----|---------|---------------|-------------------|-------------|
| **HTTPS/SSL** | ❌ HTTP | ✅ 自動SSL<br>(Let's Encrypt) | ✅ 自動SSL<br>(ACM / Let's Encrypt) | **理由**: 開発は不要、本番は必須 |
| **ファイアウォール** | ❌ なし | ✅ プラットフォーム標準 | ✅ AWS Security Group<br>WAF | **理由**: 本番は攻撃対策 |
| **認証** | JWT (開発用シークレット) | JWT (本番シークレット) | JWT (シークレット管理サービス) | **同様**: JWT使用<br>**相違**: シークレット管理方法 |
| **レート制限** | ❌ なし | ✅ express-rate-limit | ✅ 同左 + WAF | **理由**: 本番はDDoS対策 |
| **DDoS対策** | ❌ なし | ✅ Cloudflare Protection | ✅ Cloudflare + AWS Shield | **理由**: 本番は攻撃対策 |
| **秘密情報管理** | .env ファイル | 環境変数 | AWS Secrets Manager | **理由**: 本番は暗号化・監査 |

---

### 6. パフォーマンス

| 項目 | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 相違点・理由 |
|-----|---------|---------------|-------------------|-------------|
| **APIレスポンス** | 50〜200ms | 100〜300ms | 50〜100ms | **理由**: 本番スケール時は最適化 |
| **画像配信** | ローカル | CDN (Cloudflare) | CDN + 画像最適化 | **理由**: 本番は高速配信 |
| **キャッシング** | Redis (単純) | Redis + CDN | Redis + CDN + Application Cache | **理由**: 負荷に応じて多層化 |
| **データベースクエリ** | インデックスなし | インデックス最適化 | インデックス + Read Replica | **理由**: 本番はクエリ最適化 |

---

### 7. コスト

| 項目 | 開発環境 | 本番環境（MVP） | 本番環境（スケール） | 備考 |
|-----|---------|---------------|-------------------|-----|
| **フロントエンド** | 無料 | 無料 | $40/月 | Cloudflare Pages Pro |
| **バックエンド** | 無料 | $10/月 | $60〜/月 | Railway → AWS ECS |
| **データベース** | 無料 | 無料 | $100/月 | Supabase → AWS RDS |
| **Redis** | 無料 | 無料 | $20〜/月 | Upstash → ElastiCache |
| **ストレージ** | 無料 | 無料 | $15〜/月 | R2 → S3 |
| **監視** | 無料 | 無料 | $26/月 | Sentry Team |
| **合計** | **無料** | **$10/月** | **$250〜/月** | 月間注文数に応じて変動 |

---

## 環境別の主な特徴

### 開発環境の特徴

✅ **完全ローカル**: インターネット不要（Telegram Bot除く）  
✅ **即座リロード**: HMR、tsx watchで開発効率最大化  
✅ **コスト無料**: Docker Composeのみ  
✅ **セットアップ簡単**: `docker-compose up -d` で起動  
❌ **スケールしない**: 単一インスタンスのみ  
❌ **冗長化なし**: 障害時は手動復旧  

### 本番環境（MVP）の特徴

✅ **低コスト**: 月額$10、無料枠最大活用  
✅ **マネージド**: バックアップ、監視が自動  
✅ **自動デプロイ**: GitHub連携で自動リリース  
✅ **グローバル配信**: CDNで世界中から高速アクセス  
❌ **スケール限界**: 月間1万注文まで  
❌ **冗長化なし**: 単一障害点あり  

### 本番環境（スケール）の特徴

✅ **高可用性**: Multi-AZ、Auto Scaling  
✅ **高速**: Read Replica、CDN最適化  
✅ **監視充実**: メトリクス、アラート  
✅ **セキュリティ**: WAF、DDoS対策  
✅ **スケール可能**: 月間10万注文以上対応  
❌ **コスト高**: 月額$250〜  
❌ **運用複雑**: DevOps知識必要  

---

## 同様な点（全環境共通）

### ソフトウェアスタック
| レイヤー | 全環境で同じ技術 | 理由 |
|---------|----------------|------|
| **フロントエンド** | React + TypeScript | 開発・本番で同じコード |
| **バックエンド** | Express + TypeScript | 同上 |
| **ORM** | Prisma 5.x | マイグレーション共通化 |
| **データベース** | PostgreSQL 16 | SQL互換性 |
| **セッション** | Redis 7 | API互換性 |
| **ストレージ** | S3互換API | MinIO ↔ S3/R2切替容易 |

### 開発フロー
| 項目 | 全環境で同じ | 理由 |
|-----|-------------|------|
| **コード** | 同一リポジトリ | モノレポ構成 |
| **環境変数** | .envファイル形式 | 管理方法統一 |
| **API仕様** | 同一エンドポイント | フロント・バックエンド連携 |
| **データモデル** | Prismaスキーマ | 全環境で同じテーブル定義 |

---

## まとめ

| 比較観点 | 結論 |
|---------|------|
| **ソフトウェア** | ✅ 開発・本番で**ほぼ同じ**（PostgreSQL、Redis、Prisma、Express） |
| **インフラ** | ❌ 開発・本番で**大きく異なる**（Docker Compose ↔ マネージドサービス） |
| **管理方法** | ❌ 開発・本番で**異なる**（手動 ↔ 自動化・監視） |
| **コスト** | ❌ 開発・本番で**大きく異なる**（無料 ↔ $10〜$250/月） |
| **パフォーマンス** | ❌ 開発・本番で**異なる**（ローカル ↔ CDN・スケール） |

**重要**: ソフトウェアスタックは統一されているため、開発環境で動作するコードは本番環境でもそのまま動作します。違いはインフラ・管理方法のみです。
